define("rvsui/app",["jquery","stapes","rvsui/route"],function(t,i,e){"use strict";return i.subclass({constructor:function(i,e){this.$el=i,this.options=t.extend({viewClass:"rvsui-view"},e),this._view=null,this._onLoad={}},route:function(t,i){var s=this;return e(t,function(){s.runView(i,arguments)}),this},run:function(){e.reload()},runView:function(i,e){var s=this;if(this._view){if(this._view.name===i)return void this._view.instantiate.run.apply(this._view.instantiate,e);this._view.instantiate.destroy()}require([i],function(n){var r=t('<div class="'+s.options.viewClass+'"></div>'),o={name:i,instantiate:new n(r,s)};s._view=o,o.instantiate.run.apply(o.instantiate,e),o.instantiate.$el.appendTo(s.$el)})}})}),define("rvsui/checkbox",["jquery","rvsui/widgetBase","rvsui/toggle"],function(t,i){"use strict";var e=i.get("toggle");i.reg("checkbox",e.subclass({constructor:e.prototype.constructor,getClassName:function(){return"ui checkbox"}}))}),define("rvsui/loading",["jquery","rvsui/widgetBase"],function(t,i){"use strict";i.reg("loading",i.subclass({constructor:i.prototype.constructor,init:function(){this.$soure.addClass("ui"),this.$load=t('<div class="ui active inverted dimmer"><div class="ui active loader" /></div>').hide(),this.notClass=this.$soure.is(".segment")===!1,this.$load.appendTo(this.$soure)},update:function(t){t?this.show():this.hide()},show:function(){this.$load.show(),this.notClass&&this.$soure.addClass("segment")},hide:function(){this.$load.hide(),this.notClass&&this.$soure.removeClass("segment")}}))}),define("rvsui/progress",["jquery","rvsui/widgetBase"],function(t,i){"use strict";i.reg("progress",i.subclass({constructor:i.prototype.constructor,init:function(){this.$soure.addClass("ui indicating progress"),this.$val=t('<div class="bar"><div class="progress" /></div>'),this.$val.appendTo(this.$soure),this.$label=t('<div class="label" />').appendTo(this.$soure)},update:function(t){t=parseInt(t||"0"),t>100&&(t=100),t=String(t),this.$label.html(this.$soure.attr("title")||""),this.$val.css({width:t+"%"}).find(".progress").text(t+"%")}}))}),define("rvsui/rivetsExt",["rivets"],function(t){"use strict";t.adapters[":"]={observe:function(t,i,e){t.on("change:"+i,e)},unobserve:function(t,i,e){t.off("change:"+i,e)},get:function(t,i){return t.get(i)},set:function(t,i,e){t.set(i,e)}},t.configure({handler:function(t,i,e){!1===this.call(e.view.models.self,t,i)&&(i.stopPropagation&&i.preventDefault?(i.stopPropagation(),i.preventDefault()):(window.event.cancelBubble=!0,window.event.returnValue=!1))}}),t.formatters.nl2br=function(t){return String(t||"").replace(/<[^>]+>/g,"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")},t.formatters.link=function(t,i){return t?String(t)+i:""},t.formatters.has=function(t,i){return t?i:""}}),define("rvsui/route",[],function(){"use strict";return function(t){var i=[],e={},s=function(t,i){this.name=i,this.path=t,this.keys=[],this.fns=[],this.params={},this.regex=n(this.path,this.keys,!1,!1)};s.prototype.addHandler=function(t){this.fns.push(t)},s.prototype.removeHandler=function(t){for(var i=0,e=this.fns.length;e>i;i++){var s=this.fns[i];if(t==s)return void this.fns.splice(i,1)}},s.prototype.run=function(t){for(var i=0,e=this.fns.length;e>i;i++)this.fns[i].apply(this,t)},s.prototype.match=function(t,i){var e=this.regex.exec(t);if(!e)return!1;for(var s=1,n=e.length;n>s;++s){var r=this.keys[s-1],o="string"==typeof e[s]?decodeURIComponent(e[s]):e[s];r&&(this.params[r.name]=o),i.push(o)}return!0},s.prototype.toURL=function(t){var i=this.path;for(var e in t)i=i.replace("/:"+e,"/"+t[e]);if(i=i.replace(/\/:.*\?/g,"/").replace(/\?/g,""),-1!=i.indexOf(":"))throw new Error("missing parameters for url: "+i);return i};var n=function(t,i,e,s){return t instanceof RegExp?t:(t instanceof Array&&(t="("+t.join("|")+")"),t=t.concat(s?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(t,e,s,n,r,o){return i.push({name:n,optional:!!o}),e=e||"",""+(o?"":e)+"(?:"+(o?e:"")+(s||"")+(r||s&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+t+"$",e?"":"i"))},r=function(t,n){var r=t.split(" "),o=2==r.length?r[0]:null;t=2==r.length?r[1]:r[0],e[t]||(e[t]=new s(t,o),i.push(e[t])),e[t].addHandler(n)},o=function(t,i){if("function"==typeof i)r(t,i);else if("object"==typeof t)for(var e in t)r(e,t[e]);else"undefined"==typeof i&&o.navigate(t)};o.lookup=function(t,e){for(var s=0,n=i.length;n>s;s++){var r=i[s];if(r.name==t)return r.toURL(e)}},o.remove=function(t,i){var s=e[t];s&&s.removeHandler(i)},o.removeAll=function(){e={},i=[]},o.navigate=function(t,i){i=i||{};var e=i.silent||!1;e&&l(),setTimeout(function(){window.location.hash=t,e&&setTimeout(function(){c()},1)},1)};var a=function(){return window.location.hash.substring(1)},u=function(t,i){var e=[];return i.match(t,e)?(i.run(e),!0):!1},h=o.reload=function(){for(var t=a(),e=0,s=i.length;s>e;e++){var n=i[e];if(u(t,n))return}},c=function(){t.addEventListener?t.addEventListener("hashchange",h,!1):t.attachEvent("onhashchange",h)},l=function(){t.removeEventListener?t.removeEventListener("hashchange",h):t.detachEvent("onhashchange",h)};return c(),o}(window)}),define("rvsui/select",["jquery","rvsui/widgetBase"],function(t,i){"use strict";var e=t(window);i.reg("select",i.subclass({constructor:i.prototype.constructor,init:function(){this.$soure.hide(),this.isStatic=void 0!==this.$soure.attr("data-static"),this.$el=t('<div class="ui selection dropdown" />'),this.$label=t('<div class="text" />').appendTo(this.$el),this.$el.append('<i class="dropdown icon" />'),this.$list=t('<div class="menu transition hidden" tabindex="-1" />').appendTo(this.$el),this.$label.text(this.$soure.attr("title")||this.$soure.attr("placeholder")||""),this.list=null,this.syncList(),this.$soure.data("proxyEl",this.$el),this.$el.insertAfter(this.$soure)},syncList:function(){var i=this;if(null===this.list||!1===this.isStatic){this.list=[],this.$list.find(".item").remove();var e="";this.$soure.find("option").each(function(){var s=t(this),n={value:s.val(),text:s.text()};e+='<div class="item" data-value="'+n.value+'">'+n.text+"</div>",i.list.push(n)}),this.$list.html(e)}return this.list},update:function(t){if(this.$soure.val(t),this.$list.find(".selected").attr("class","item"),t){var i=this.$list.find("[data-value="+t+"]").attr("class","item active selected");i.length>0&&this.$label.text(i.text())}},showList:function(){this.$el.attr("class","ui selection dropdown active visible"),this.$list.attr("class","menu transition visible")},hideList:function(){this.$el.attr("class","ui selection dropdown"),this.$list.attr("class","menu transition hidden")},watch:function(){var i=this;this.$el.on("click",function(){return i.showList(),i.syncList(),!1===i.isStatic&&i.update(i.getValue()),!1}).on("click",".item",function(){var e=t(this),s=e.attr("data-value");return i.sync(s),i.hideList(),i.$soure.trigger("change"),!1}),e.on("click.rvsuiSelect"+this.id,function(){i.hideList()})},destroy:function(){this.$el.remove(),e.off("click.rvsuiSelect"+this.id)}}))}),function(){function t(t,e,s,n){return new i(t,e,s,n)}function i(t,i,s,n){this.options=n||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=i,this.callback=s,this.objectPath=[],this.parse(),e(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function e(t){return"object"==typeof t&&null!==t}function s(t){throw new Error("[sightglass] "+t)}t.adapters={},i.tokenize=function(t,i,e){var s,n,r=[],o={i:e,path:""};for(s=0;s<t.length;s++)n=t.charAt(s),~i.indexOf(n)?(r.push(o),o={i:n,path:""}):o.path+=n;return r.push(o),r},i.prototype.parse=function(){var e,n,r=this.interfaces();r.length||s("Must define at least one adapter interface."),~r.indexOf(this.keypath[0])?(e=this.keypath[0],n=this.keypath.substr(1)):("undefined"==typeof(e=this.options.root||t.root)&&s("Must define a default root adapter."),n=this.keypath),this.tokens=i.tokenize(n,r,e),this.key=this.tokens.pop()},i.prototype.realize=function(){var t,i=this.obj,s=!1;return this.tokens.forEach(function(n,r){e(i)?("undefined"!=typeof this.objectPath[r]?i!==(t=this.objectPath[r])&&(this.set(!1,n,t,this.update.bind(this)),this.set(!0,n,i,this.update.bind(this)),this.objectPath[r]=i):(this.set(!0,n,i,this.update.bind(this)),this.objectPath[r]=i),i=this.get(n,i)):(s===!1&&(s=r),(t=this.objectPath[r])&&this.set(!1,n,t,this.update.bind(this)))},this),s!==!1&&this.objectPath.splice(s),i},i.prototype.update=function(){var t,i;(t=this.realize())!==this.target&&(e(this.target)&&this.set(!1,this.key,this.target,this.callback),e(t)&&this.set(!0,this.key,t,this.callback),i=this.value(),this.target=t,this.value()!==i&&this.callback())},i.prototype.value=function(){return e(this.target)?this.get(this.key,this.target):void 0},i.prototype.setValue=function(t){e(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},i.prototype.get=function(t,i){return this.adapter(t).get(i,t.path)},i.prototype.set=function(t,i,e,s){var n=t?"observe":"unobserve";this.adapter(i)[n](e,i.path,s)},i.prototype.interfaces=function(){var i=Object.keys(this.options.adapters);return Object.keys(t.adapters).forEach(function(t){~i.indexOf(t)||i.push(t)}),i},i.prototype.adapter=function(i){return this.options.adapters[i.i]||t.adapters[i.i]},i.prototype.unobserve=function(){var t;this.tokens.forEach(function(i,e){(t=this.objectPath[e])&&this.set(!1,i,t,this.update.bind(this))},this),e(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define("sightglass",[],function(){return this.sightglass=t}):this.sightglass=t}.call(this),define("rvsui/toggle",["jquery","rvsui/widgetBase"],function(t,i){"use strict";i.reg("toggle",i.subclass({constructor:i.prototype.constructor,getClassName:function(){return"ui toggle checkbox"},init:function(){this.$soure.wrap('<div class="'+this.getClassName()+'"/>'),this.$el=this.$soure.parent(),this.$label=t("<label />"),this.$label.text(this.$soure.attr("title")||""),this.$label.appendTo(this.$el)},update:function(t){String(t)===String(this.$soure.val())?(this.$soure.prop("checked",!0),this.$el.attr("class",this.getClassName()+" checked")):(this.$soure.prop("checked",!1),this.$el.attr("class",this.getClassName()))},watch:function(){var t=this;this.$el.on("click",function(){return t.sync(t.$soure.prop("checked")?"":t.$soure.val()),t.$soure.trigger("change"),!1})}}))}),define("rvsui/validator",["jquery","rvsui/widgetBase"],function(t,i){"use strict";var e={},s=function(t,i){e[t]=i};return s("required",function(i,e){return e=e||"不能为空",-1!==["checkbox","radio"].indexOf(i.attr("type"))?{status:i.prop("checked"),msg:e}:{status:t.trim(i.val()).length>0,msg:e}}),s("minlength",function(i,e,s){s=s||"最小"+e+"位字符",e=Number(e);var n=t.trim(i.val());return{status:n.length>=e,msg:s}}),s("maxlength",function(i,e,s){s=s||"最多"+e+"位字符",e=Number(e);var n=t.trim(i.val());return{status:n.length<=e,msg:s}}),s("min",function(t,i,e){e=e||"数值要大于"+i,i=Number(i);var s=parseInt(t.val());return{status:s>=i,msg:e}}),s("max",function(t,i,e){e=e||"数值要小于"+i,i=Number(i);var s=parseInt(t.val());return{status:i>=s,msg:e}}),s("equals",function(t,i,e){return e=e||"两次输入的值不相符",{status:t.val()===i.val(),msg:e}}),s("isEmail",function(i,e){e=e||"邮箱格式不正确";var s=t.trim(i.val());return{status:0===s.length||/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i.test(s),msg:e}}),s("isDate",function(i,e){e=e||"日期格式不正确";var s=t.trim(i.val()),n=function(t){var i,e,s,n,r,o=/^([1-2]\d{3})([-/.])?(1[0-2]|0?[1-9])([-/.])?([1-2]\d|3[01]|0?[1-9])$/;return o.test(t)?(i=o.exec(t),s=+i[1],n=+i[3]-1,r=+i[5],e=new Date(s,n,r),s===e.getFullYear()&&n===e.getMonth()&&r===e.getDate()):!1};return{status:0===s.length||n(s),msg:e}}),s("isMobile",function(i,e){e=e||"手机格式不正确";var s=t.trim(i.val());return{status:0===s.length||/^1[3-9]\d{9}$/.test(s),msg:e}}),s("isTel",function(i,e){e=e||"座机格式不正确";var s=t.trim(i.val());return{status:0===s.length||/^(?:(?:0\d{2,3}[- ]?[1-9]\d{6,7})|(?:[48]00[- ]?[1-9]\d{6}))$/.test(s),msg:e}}),s("isUrl",function(i,e){e=e||"url 格式不正确";var s=function(){var t="((https?|s?ftp|irc[6s]?|git|afp|telnet|smb):\\/\\/)?",i="([a-z0-9]\\w*(\\:[\\S]+)?\\@)?",e="(?:localhost|(?:[a-z0-9]+(?:[-\\w]*[a-z0-9])?(?:\\.[a-z0-9][-\\w]*[a-z0-9])*)*\\.[a-z]{2,})",s="(:\\d{1,5})?",n="\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",r="(\\/\\S*)?",o=[t,i,e,s,r],a=[t,i,n,s,r],u=new RegExp("^"+o.join("")+"$","i"),h=new RegExp("^"+a.join("")+"$","i");return function(t){return u.test(t)||h.test(t)}}(),n=t.trim(i.val());return{status:0===n.length||s(n),msg:e}}),s("maxLength",e.maxlength),s("minLength",e.minlength),i.reg("validator",i.subclass({constructor:i.prototype.constructor,init:function(){var t=this;this.$soure.addClass("ui"),this.initLoading(),this.initRules(),this.$soure.data("check",function(){return t.check()}).data("initRules",function(){return t.initRules()}).data("loading",t.loading)},initLoading:function(){var i=this;this.$load=t('<div class="ui active inverted dimmer"><div class="ui active loader" /></div>').hide(),this.$load.appendTo(this.$soure),this.loading={show:function(){i.$load.show(),i.$soure.addClass("segment")},hide:function(){i.$load.hide(),i.$soure.removeClass("segment")}}},initRules:function(){var i=this;this.rules=[],this.$validators=this.$soure.find("[validator]"),this.$validators.each(function(){i.parseValidator(t(this))})},watch:function(){var i=this;this.$soure.on("focus change","[validator]",function(){var e=t(this);i.hideError(e)}).on("click",".popup",function(){var i=t(this);return i.removeClass("visible").addClass("hidden"),i.data("soure").focus(),!1})},getData:function(){var t={};return this.$soure.serializeArray().forEach(function(i){t[i.name]=i.value}),t},check:function(){var i=!0,e=this;return this.loading.show(),t.each(this.rules,function(t,s){var n=s.rule.apply(null,s.args);return n.status!==!0?(i=!1,e.showError(s.args[0],n.msg),e.loading.hide(),!1):void 0}),i?this.getData():!1},showError:function(t,i){var e=this.getErrorTip(t);e.html(i)},hideError:function(t){var i=t.data("tip");i&&i.removeClass("visible").addClass("hidden")},getErrorTip:function(i){var e=i.data("tip");e?e.addClass("visible").removeClass("hidden"):(e=t('<div class="ui red label popup transition bottom left visible" />'),e.appendTo(this.$soure),e.data("soure",i),i.data("tip",e));var s=i.data("proxyEl")||i,n=s.offset();return n.top+=(i.height()||20)+3,e.css(n),e},parseValidator:function(i){var s=this;i.attr("validator").split("|").forEach(function(n){var r=n.split(" ").filter(function(i){return t.trim(i).length>0}),o=e[r[0]],a=r[0];"equals"===a&&(r[1]=s.$soure.find(r[1])),r[0]=i,o?s.rules.push({rule:o,args:r}):console.log("validator rule: "+a+" undefined !")})}})),{add:s}}),define("rvsui/view",["jquery","stapes","rivets","rvsui/rivetsExt"],function(t,i,e){"use strict";var s=t("title");return i.subclass({constructor:function(t,i){this.$el=t,this.app=i,this.init()},init:function(){},run:function(){},watch:function(){},setTitle:function(t){s.text(t)},back:function(){return window.history.length>1?window.history.back():window.location.href="#",!1},destroy:function(){this.unbind(),this.$el.remove()},renderString:function(i,e){var s=t.Deferred(),n=this;e=e||{},this.view||(this.$el.html(i),this.bind(),this.watch());var r=Object.keys(e);if(0===r.length)s.resolve();else{var o=[];r.forEach(function(t){o.push(e[t])}),n.when.apply(n,o).done(function(){var i=Array.prototype.slice.call(arguments);t.each(i,function(t,i){var e=r[t];e&&n.set(e,i)}),s.resolve()}).fail(function(){s.reject()})}return s.promise()},render:function(i,e){var s=this,n=t.Deferred();return this.loadTpl(i).done(function(t){s.renderString(t,e).done(function(){n.resolve()}).fail(function(){n.reject()})}),n.promise()},loadTpl:function(i){var e=t.Deferred(),s=i.split("/");return 2===s.length&&require(["tpl/"+s[0]],function(t){var i=t[s[1]];e.resolve(i)}),e.promise()},bind:function(){return this.view?this.view:(this.view=e.bind(this.$el,{self:this}),this.view)},unbind:function(){this.view&&this.view.unbind(),this.$el.off()},when:function(){return t.when.apply(this,arguments)}})}),define("rvsui/widgetBase",["jquery","stapes","rivets"],function(t,i,e){"use strict";var s=0,n={},r=i.subclass({constructor:function(i,e){this.id=s++,this.view=e,this.$soure=t(i),this.init(),this.watch()},init:function(){},watch:function(){},getValue:function(){return this.$soure.val()},update:function(t){this.$soure.val(t)},destroy:function(){this.$soure.remove(),this.$el&&this.$el.remove()},sync:function(t){if(-1!==this.view.keypath.indexOf(":")){var i=this.view.keypath.split(":"),e=i[0],s=i.pop(),n=s.split(".").pop(),r=this.view.observer.obj[e];r&&this.view.model.set(n,t)}}});return r.reg=function(t,i){n[t]=i,e.binders[t]={bind:function(t){this.widget=new i(t,this)},unbind:function(){this.widget.destroy()},routine:function(t,i){this.widget.update(i||"",t)}}},r.get=function(t){return n[t]},r}),define("rvsui/window",["jquery","stapes"],function(t,i){"use strict";var e=t(window),s=0,n=i.subclass({constructor:function(i,e){this.options=t.extend({title:"",content:"",yes:"确认"},i),this.id=s++,this.$root=e||t("body"),this.initDom(),this.setTitle(this.options.title),this.setContent(this.options.content),this.watch()},watch:function(){var t=this;this.$el.on("click","[role=close]",function(){return t.hide(),!1}).on("click","[role=yes]",function(){return t.emit("yes"),t.hide(),!1}).on("click",".modal",function(){return!1}).on("click",function(){return t.hide(),!1}),e.on("resize.rvsuiWindow"+this.id,function(){t.setPosition()})},destroy:function(){this.$el.remove(),e.off("resize.rvsuiWindow"+this.id)},setTitle:function(i){"string"===t.type(i)?this.$title.html(i):i.appendTo&&(this.$title.children().remove(),i.appendTo(this.$title)),this.emit("setTitle",i)},setContent:function(i){"string"===t.type(i)?this.$content.html(i):i.appendTo&&(this.$content.children().remove(),i.appendTo(this.$console)),this.emit("setTitle",i)},setPosition:function(){var t=this.$win.height()/2;t>e.height()&&(t=e.height()/2-25),this.$win.css({marginTop:-t})},show:function(){this.$el.removeClass("hidden").addClass("visible active"),this.$win.removeClass("hidden").addClass("visible active"),this.setPosition(),this.emit("show")},hide:function(){this.$el.removeClass("visible active").addClass("hidden"),this.$win.removeClass("visible active").addClass("hidden"),this.emit("hide")},initDom:function(){this.$el=t('<div class="ui dimmer modals page transition hidden"><div class="ui small modal transition hidden"><i role="close" class="close icon" /><div class="header" /><div class="content" /><div class="actions" /></div></div>'),this.$title=this.$el.find(".header"),this.$content=this.$el.find(".content"),this.$actions=this.$el.find(".actions"),this.$win=this.$el.find(".modal"),this.initActions(),this.$el.appendTo(this.$root)},initActions:function(){this.$actions.html('<div role="yes" class="ui green button">'+this.options.yes+"</div>")}});return n.alert=function(t,i,e){e=e||"提示信息",i=i||function(){};var s=!1;return n._alert?(n._alert.off("hide"),n._alert.off("yes"),n._alert.setTitle(e),n._alert.setContent(t)):n._alert=new n({title:e,content:t}),n._alert.on("hide",function(){s===!1&&i(!1)}),n._alert.on("yes",function(){s=!0,i(!0)}),n._alert.show(),n._alert},n.Confirm=n.subclass({constructor:n.prototype.constructor,watch:function(){n.Confirm.parent.watch.call(this);var t=this;this.$el.on("click","[role=no]",function(){return t.emit("no"),t.hide(),!1})},initActions:function(){var t=this.options.yes||"是",i=this.options.no||"否";this.$actions.html('<div role="no" class="ui negative button">'+i+'</div><div role="yes" class="ui positive right labeled icon button">'+t+' <i class="checkmark icon"></i></div>')}}),n.confirm=function(t,i,e){i=i||function(){},e=e||"请确认";var s=!1;n._confirm?(n._confirm.off("hide"),n._confirm.off("yes"),n._confirm.off("no"),n._confirm.setTitle(e),n._confirm.setContent(t)):n._confirm=new n.Confirm({title:e,content:t}),n._confirm.on("hide",function(){!1===s&&i(!1)}),n._confirm.on("yes",function(){s=!0,i(!0)}),n._confirm.on("no",function(){s=!0,i(!1)}),n._confirm.show()},n}),define("rvsui",["rvsui/app","rvsui/view","rvsui/window","rvsui/select","rvsui/toggle","rvsui/checkbox","rvsui/validator","rvsui/loading","rvsui/progress"],function(t,i,e){"use strict";return{App:t,View:i,Window:e}});